[gd_scene load_steps=6 format=3 uid="uid://dmqghto7aslfc"]

[ext_resource type="Texture2D" uid="uid://dh3kfq464bhis" path="res://Frames/node.png" id="1_7poir"]

[sub_resource type="GDScript" id="GDScript_fpcbi"]
script/source = "extends Area2D

var nutrients : int = 0
var nutrient_nodes : Dictionary = {}
@export var nutrient_consumption_amount : int = 1
@export var nutrient_consumption_rate : float = 1.0
var nutrient_consumption_timer : Timer = Timer.new()


# Called when the node enters the scene tree for the first time.
func _ready():
	$\"/root/SceneGlobal\".child_node_pass(self)
	# Make nutrient timer a child of mycelia node, configure, start, and connect it to _consume_nutrients func
	add_child(nutrient_consumption_timer)
	nutrient_consumption_timer.wait_time = nutrient_consumption_rate
	nutrient_consumption_timer.start()
	nutrient_consumption_timer.timeout.connect(_consume_nutrients)
	 
# Called every frame. 'delta' is the elapsed time since the previous frame.
func _process(delta):
	pass

func _consume_nutrients():
	var nutrient_node_keys : Array = nutrient_nodes.keys()
	for key in nutrient_node_keys:
		var consumed_nutrients : int = nutrient_nodes[key].consume_resources(nutrient_consumption_amount)
		if consumed_nutrients == 0:
			remove_nutrient_node(key)
		else:
			add_nutrients(consumed_nutrients)
	nutrient_consumption_timer.wait_time = nutrient_consumption_rate 

func add_nutrient_node(nutrient_node):
	nutrient_nodes.merge({nutrient_node : nutrient_node})

func remove_nutrient_node(nutrient_node):
	nutrient_nodes.erase(nutrient_node)

func add_nutrients(amount : int):
	nutrients += amount

func remove_nutrients(amount : int) -> bool:
	if nutrients == 0:
		return false
		pass
	if nutrients < amount:
		nutrients -= nutrients
	else:
		nutrients -= amount
	return true
	
	
		
"

[sub_resource type="ShaderMaterial" id="ShaderMaterial_l0swx"]

[sub_resource type="CircleShape2D" id="CircleShape2D_y5fyk"]

[sub_resource type="SpriteFrames" id="SpriteFrames_m0ial"]
animations = [{
"frames": [{
"duration": 1.0,
"texture": ExtResource("1_7poir")
}],
"loop": true,
"name": &"default",
"speed": 5.0
}]

[node name="Mycelia Node" type="Area2D"]
script = SubResource("GDScript_fpcbi")
metadata/_edit_group_ = true

[node name="CollisionShape2D" type="CollisionShape2D" parent="."]
material = SubResource("ShaderMaterial_l0swx")
shape = SubResource("CircleShape2D_y5fyk")
one_way_collision_margin = 1.2
debug_color = Color(0, 0.6, 0.701961, 0.419608)

[node name="AnimatedSprite2D" type="AnimatedSprite2D" parent="."]
position = Vector2(1, 1)
scale = Vector2(1.7, 1.691)
sprite_frames = SubResource("SpriteFrames_m0ial")
